{{/*
  Calendar Subscribe Buttons Partial

  Displays buttons that let users subscribe to the Google Calendar
  in their own calendar applications (Google, Apple, Outlook, etc.)
  Shows a helpful placeholder when the iCal URL is not yet configured.

  Requirements:
  - site.Params.calendar.calendar_enabled = true
  - site.Params.calendar.calendar_subscribe_enabled = true
  - site.Params.calendar.calendar_ical_url must be set for live buttons

  Usage:
    {{ partial "calendar-subscribe.html" . }}
*/}}

{{ if and site.Params.calendar.calendar_enabled site.Params.calendar.calendar_subscribe_enabled }}
<div class="calendar-subscribe">
    <div class="calendar-subscribe-header">
        <h3>{{ site.Params.calendar.calendar_subscribe_text | default "Subscribe to Calendar" }}</h3>
        <p>Get automatic updates when we add new events</p>
    </div>

    {{ if site.Params.calendar.calendar_ical_url }}
    {{/* Live subscribe buttons */}}
    <div class="calendar-subscribe-buttons">
        {{/* Google Calendar Subscribe Link */}}
        <a
            href="https://calendar.google.com/calendar/r?cid={{ site.Params.calendar.calendar_ical_url | urlquery }}"
            target="_blank"
            rel="noopener noreferrer"
            class="calendar-subscribe-btn {{ if eq site.Params.calendar.calendar_subscribe_style "primary" }}btn-primary{{ else }}btn-secondary{{ end }}"
            aria-label="Subscribe with Google Calendar"
        >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2zm-7 5h5v5h-5z"/>
            </svg>
            <span>Google Calendar</span>
        </a>

        {{/* Apple Calendar Subscribe Link (webcal://) */}}
        {{ $webcalUrl := replace site.Params.calendar.calendar_ical_url "https://" "webcal://" }}
        <a
            href="{{ $webcalUrl }}"
            class="calendar-subscribe-btn {{ if eq site.Params.calendar.calendar_subscribe_style "primary" }}btn-primary{{ else }}btn-secondary{{ end }}"
            aria-label="Subscribe with Apple Calendar"
        >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
            </svg>
            <span>Apple Calendar</span>
        </a>

        {{/* Outlook Web Subscribe Link */}}
        <a
            href="https://outlook.live.com/owa/?path=/calendar/action/compose&rru=addsubscription&url={{ site.Params.calendar.calendar_ical_url | urlquery }}&name={{ site.Title | urlquery }}"
            target="_blank"
            rel="noopener noreferrer"
            class="calendar-subscribe-btn {{ if eq site.Params.calendar.calendar_subscribe_style "primary" }}btn-primary{{ else }}btn-secondary{{ end }}"
            aria-label="Subscribe with Outlook"
        >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M7 2h10c1.1 0 2 .9 2 2v16c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2zm0 2v16h10V4H7zm2 2h6v2H9V6zm0 4h6v2H9v-2zm0 4h4v2H9v-2z"/>
            </svg>
            <span>Outlook</span>
        </a>

        {{/* Download .ics File (Universal) */}}
        <a
            href="{{ site.Params.calendar.calendar_ical_url }}"
            download
            class="calendar-subscribe-btn {{ if eq site.Params.calendar.calendar_subscribe_style "primary" }}btn-primary{{ else }}btn-secondary{{ end }}"
            aria-label="Download calendar file"
        >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span>Download (.ics)</span>
        </a>
    </div>

    <p class="calendar-subscribe-note">
        <small>Subscribing will automatically sync future events and updates to your calendar.</small>
    </p>

    {{ else }}
    {{/* Placeholder when iCal URL not configured */}}
    <div class="calendar-subscribe-placeholder">
        <p>Subscribe buttons will appear here once the calendar is configured.</p>
        <p class="calendar-placeholder-note">
            <small>Add your Google Calendar iCal URL in hugo.toml to enable subscribe buttons.</small>
        </p>
    </div>
    {{ end }}
</div>
{{ end }}
